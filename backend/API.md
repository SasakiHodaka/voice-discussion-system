# EchoMind API Documentation

## Overview

EchoMind Backend is a FastAPI application providing REST APIs and WebSocket support for real-time discussion facilitation.

### Base URL

Development: `http://localhost:8000`

### Authentication

Currently no authentication. For production, implement JWT or similar.

---

## REST API Endpoints

### Sessions

#### Create Session
```
POST /api/sessions/
```

**Parameters:**
- `title` (string, required): Session title
- `description` (string, optional): Session description
- `creator_name` (string, optional): Facilitator name

**Response:**
```json
{
  "session_id": "abc12345",
  "title": "Discussion Title",
  "participants": [
    {
      "participant_id": "xyz789",
      "name": "Facilitator",
      "role": "facilitator",
      "joined_at": "2024-01-07T10:00:00"
    }
  ],
  "created_at": "2024-01-07T10:00:00",
  "segments": []
}
```

#### Get Session
```
GET /api/sessions/{session_id}
```

**Response**: Same as Create Session

#### List All Sessions
```
GET /api/sessions/
```

**Response**: Array of session objects

#### Add Participant
```
POST /api/sessions/{session_id}/participants
```

**Parameters:**
- `name` (string, required): Participant name
- `role` (string, optional): "facilitator", "participant", or "observer"

**Response**: Participant object

#### Remove Participant
```
DELETE /api/sessions/{session_id}/participants/{participant_id}
```

**Response:**
```json
{
  "status": "ok",
  "removed_participant_id": "xyz789"
}
```

#### Get Segments
```
GET /api/sessions/{session_id}/segments
```

**Response**: Array of segment results

#### End Session
```
POST /api/sessions/{session_id}/end
```

**Response**: Updated session object with end time and duration

---

### Analysis

#### Analyze Segment
```
POST /api/analysis/segment
```

**Parameters:**
- `session_id` (string, required)
- `segment_id` (integer, required)
- `start_sec` (float, required): Start time in seconds
- `end_sec` (float, required): End time in seconds
- `utterances` (array, optional): Array of utterance objects

**Utterance Format:**
```json
{
  "utterance_id": "u001",
  "start": 0.0,
  "end": 5.0,
  "speaker": "John",
  "text": "What is the main issue?"
}
```

**Response:**
```json
{
  "session_id": "abc12345",
  "segment_id": 0,
  "start_sec": 0.0,
  "end_sec": 20.0,
  "status": "OK",
  "Q": 3,
  "A": 2,
  "M": 0.5,
  "T": 0.2,
  "L": 0.8
}
```

---

## WebSocket Events

The WebSocket server runs at `ws://localhost:8000/socket.io` using Socket.IO protocol.

### Client → Server Events

#### join
Join a discussion session.
```json
{
  "session_id": "abc12345",
  "participant_name": "Alice",
  "role": "participant"
}
```

#### send_text
Send a message to the session.
```json
{
  "session_id": "abc12345",
  "participant_id": "xyz789",
  "text": "Here is my contribution"
}
```

#### analyze_segment
Trigger analysis for a segment.
```json
{
  "session_id": "abc12345",
  "segment_id": 0,
  "start_sec": 0.0,
  "end_sec": 20.0,
  "utterances": []
}
```

#### leave
Leave a session.
```json
{
  "session_id": "abc12345",
  "participant_id": "xyz789"
}
```

### Server → Client Events

#### participant_joined
A new participant joined.
```json
{
  "session_id": "abc12345",
  "participant": {
    "participant_id": "xyz789",
    "name": "Alice",
    "role": "participant"
  }
}
```

#### participant_left
A participant left.
```json
{
  "session_id": "abc12345",
  "participant_id": "xyz789"
}
```

#### text_received
Message from a participant.
```json
{
  "session_id": "abc12345",
  "participant_id": "xyz789",
  "text": "The message",
  "timestamp": "2024-01-07T10:00:00"
}
```

#### segment_analyzed
Analysis result for a segment.
```json
{
  "session_id": "abc12345",
  "segment_id": 0,
  "result": {
    // Full SegmentResult object
  }
}
```

#### error
Error message.
```json
{
  "message": "Error description"
}
```

---

## Interactive Documentation

- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc

These are automatically generated by FastAPI from your route definitions.

---

## Data Models

### SegmentResult

Represents analysis results for a 20-second segment:

- `session_id`: Unique session identifier
- `segment_id`: Segment number
- `status`: Analysis status (OK, NOT_VALID, NOT_EVALUABLE)
- `Q`: Question count
- `A`: Answer count
- `UQ`: Unanswered question count
- `R`: Refutation/disagreement count
- `M`: Confusion score (0-1)
- `T`: Stagnation score (0-1)
- `L`: Understanding score (0-1)
- `is_risky`: Flag for risky patterns

### ParticipantModel

- `participant_id`: Unique identifier
- `name`: Participant name
- `role`: facilitator | participant | observer
- `joined_at`: Join timestamp

### DiscussionSessionModel

- `session_id`: Unique session identifier
- `title`: Session title
- `participants`: List of participants
- `created_at`: Creation timestamp
- `started_at`: Start timestamp (optional)
- `ended_at`: End timestamp (optional)
- `duration_sec`: Total duration in seconds
- `segments`: List of SegmentResult objects
